<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ASP.NET SignalR Stock Ticker</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, Helvetica, sans-serif;
            font-size: 16px;
        }

        #stockTable table {
            border-collapse: collapse;
        }

            #stockTable table th, #stockTable table td {
                padding: 2px 6px;
            }

            #stockTable table td {
                text-align: right;
            }

        #stockTable .loading td {
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Product List</h1>

    <!--<h2>Live Stock Table</h2>-->
    <div id="stockTable">
        <table border="1">
            <thead>
            <tr>
                <th>Id</th><th>Symbol</th><th>Name</th><th>CName</th><th>Last</th><th>Ccy2</th>
                <th>QuoteType<br/>0:close<br />1:open<br />2:phone only</th>
                <th>LastOpen</th><th>LastClose</th><th>PreClose</th><th>Open</th><th>MaxLev</th><th>MinLongVal</th><th>MinShortVal</th><th>MaxLongVal</th><th>MaxShortVal</th><!--<th>%</th>-->
            </tr>
            </thead>
            <tbody>
                <tr class="loading"><td colspan="16">loading...</td></tr>
            </tbody>
        </table>
        <!--<textarea id="log" style="width: 800px; height: 600px"></textarea>-->
    </div>

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="/Scripts/jquery-1.6.4.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-2.2.0.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    <!--Reference the StockTicker script. -->
    <script type="text/javascript">
        // A simple templating method for replacing placeholders enclosed in curly braces.
        if (!String.prototype.supplant) {
            String.prototype.supplant = function (o) {
                return this.replace(/{([^{}]*)}/g,
                    function (a, b) {
                        var r = o[b];
                        return typeof r === 'string' || typeof r === 'number' ? r : a;
                    }
                );
            };
        }

        $(function () {

            var ticker = 
                $stockTable = $('#stockTable'),
                $stockTableBody = $stockTable.find('tbody'),
                rowTemplate = '<tr data-symbol="{id}"><td>{id}</td><td>{symbol}</td><td>{name}</td><td>{cname}</td><td>{last}</td><td>{ccy2}</td><td>{quoteType}</td><td>{lastOpen}</td><td>{lastClose}</td><td>{preClose}</td><td>{open}</td><td>{maxLeverage}</td><td>{minValueLong}</td><td>{minValueShort}</td><td>{maxValueLong}</td><td>{maxValueShort}</td></tr>';

            function formatStock(stock) {
                //return $.extend(stock, {
                //    Offer: stock.Offer.toFixed(2),
                //    PercentChange: (stock.last*1.03 * 100).toFixed(2) + '%',
                //    Direction: stock.Change === 0 ? '' : stock.Change >= 0 ? up : down
                //});
                return stock;
            }

            $(function () {
                $.ajax('api/security/all').done(function (stocks) {
                    $stockTableBody.empty();
                    $.each(stocks, function () {
                        var stock = formatStock(this);
                        $stockTableBody.append(rowTemplate.supplant(stock));
                    });
                });
            });
        });
    </script>
</body>
</html>